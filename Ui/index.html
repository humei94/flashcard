<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSK 3 Flashcard Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS Styles --- */
        body {
            font-family: 'Sarabun', 'Noto Sans SC', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        h1 { color: #34495e; font-size: 20px; margin-bottom: 10px; }

        .card-container {
            width: 360px; 
            height: 520px; 
            perspective: 1000px;
            margin-bottom: 20px;
            position: relative;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-radius: 24px;
        }

        .card.is-flipped { transform: rotateY(180deg); }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 25px;
            box-sizing: border-box;
            background: white;
            border: 1px solid #eee;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß (Favorite) */
        .star-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 32px;
            background: none;
            border: none;
            cursor: pointer;
            z-index: 10;
            color: #ddd; /* ‡∏™‡∏µ‡∏ï‡∏≠‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Å‡∏î */
            transition: color 0.2s, transform 0.2s;
        }
        .star-btn.active {
            color: #f1c40f; /* ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏ï‡∏≠‡∏ô‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß */
            transform: scale(1.2);
        }
        .star-btn:hover { transform: scale(1.1); }

        /* Front Face */
        .card-front { background: linear-gradient(135deg, #ffffff 0%, #f9f9f9 100%); }
        .hanzi-lg { font-size: 80px; font-weight: bold; color: #c0392b; margin-bottom: 20px; }
        .tap-hint { font-size: 14px; color: #aaa; margin-top: 40px; }

        /* Back Face */
        .card-back {
            background: #2c3e50;
            color: white;
            transform: rotateY(180deg);
            align-items: flex-start;
            text-align: left;
            overflow-y: auto;
        }
        .card-back::-webkit-scrollbar { width: 4px; }
        .card-back::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); }

        .header-group { width: 100%; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; margin-bottom: 15px; }
        .pinyin { font-size: 28px; color: #f1c40f; font-weight: 500; }
        .meaning { font-size: 22px; font-weight: bold; margin-top: 5px;}
        .type-tag { display: inline-block; background: rgba(255,255,255,0.15); padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-top: 5px; color: #bdc3c7; }
        .section-title { font-size: 14px; color: #95a5a6; margin-bottom: 5px; margin-top: 10px; text-transform: uppercase; letter-spacing: 1px;}
        .example-box { background: rgba(0,0,0,0.2); padding: 12px; border-radius: 12px; width: 100%; margin-bottom: 10px; }
        .ex-cn { font-size: 18px; color: #fff; margin-bottom: 4px; font-weight: 400; line-height: 1.4;}
        .ex-th { font-size: 14px; color: #bdc3c7; font-style: italic; }
        .note-box { font-size: 14px; color: #ecf0f1; line-height: 1.5; background: rgba(230, 126, 34, 0.1); border-left: 3px solid #e67e22; padding: 8px 12px; border-radius: 0 8px 8px 0; width: 100%; }

        /* Controls */
        .controls { display: flex; align-items: center; gap: 15px; margin-top: 15px; }
        .nav-btn {
            background: #34495e; color: white; border: none; padding: 12px 20px;
            border-radius: 50px; cursor: pointer; transition: 0.2s; font-size: 18px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .nav-btn:hover { background: #2c3e50; transform: translateY(-2px); }
        .progress { font-weight: 600; color: #555; font-size: 16px; min-width: 80px; text-align: center;}

        /* Menu Bar (‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î‡∏ï‡πà‡∏≤‡∏á‡πÜ) */
        .menu-bar {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        .mode-btn {
            padding: 8px 16px;
            border: 1px solid #ccc;
            background: white;
            color: #555;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Sarabun', sans-serif;
            font-size: 14px;
            transition: all 0.2s;
        }
        .mode-btn:hover { background: #eee; }
        .mode-btn.active {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }
        .mode-btn.shuffle-active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

    </style>
</head>
<body>

    <h1 id="mode-title">HSK 3 Flashcards</h1>

    <div class="card-container">
        <button class="star-btn" id="star-btn" onclick="toggleHard(event)">‚òÖ</button>

        <div class="card" id="flashcard" onclick="flipCard()">
            <div class="card-face card-front">
                <div class="hanzi-lg" id="front-hanzi">...</div>
                <div class="tap-hint">(‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢)</div>
            </div>

            <div class="card-face card-back">
                <div class="header-group">
                    <div class="pinyin" id="back-pinyin">...</div>
                    <div class="meaning" id="back-meaning">...</div>
                    <span class="type-tag" id="back-type">...</span>
                </div>

                <div class="section-title">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ</div>
                <div class="example-box">
                    <div class="ex-cn" id="back-ex-cn">...</div>
                    <div class="ex-th" id="back-ex-th">...</div>
                </div>

                <div id="note-section" style="display:none; width: 100%;">
                    <div class="section-title">‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï / ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</div>
                    <div class="note-box" id="back-note">...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="nav-btn" onclick="prevCard()">&#10094;</button>
        <span class="progress" id="progress-text">0 / 0</span>
        <button class="nav-btn" onclick="nextCard()">&#10095;</button>
    </div>

    <div class="menu-bar">
        <button class="mode-btn active" id="btn-all" onclick="setMode('all')">üìö ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        <button class="mode-btn" id="btn-shuffle" onclick="setMode('shuffle')">üîÄ ‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥</button>
        <button class="mode-btn" id="btn-hard" onclick="setMode('hard')">‚≠ê ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (<span id="hard-count">0</span>)</button>
    </div>

    <script>
        // --- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å ---
        let allWords = [];      // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 600 ‡∏Ñ‡∏≥
        let currentDeck = [];   // ‡∏Å‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà (‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏≥‡∏¢‡∏≤‡∏Å)
        let currentIndex = 0;   // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        let hardList = [];      // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà Hanzi)
        let currentMode = 'all'; // all, shuffle, hard

        // --- Elements ---
        const els = {
            card: document.getElementById('flashcard'),
            hanzi: document.getElementById('front-hanzi'),
            pinyin: document.getElementById('back-pinyin'),
            meaning: document.getElementById('back-meaning'),
            type: document.getElementById('back-type'),
            exCn: document.getElementById('back-ex-cn'),
            exTh: document.getElementById('back-ex-th'),
            note: document.getElementById('back-note'),
            noteSection: document.getElementById('note-section'),
            progress: document.getElementById('progress-text'),
            starBtn: document.getElementById('star-btn'),
            hardCount: document.getElementById('hard-count'),
            modeTitle: document.getElementById('mode-title')
        };

        // --- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
        async function loadData() {
            try {
                // 1. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå
                const res = await fetch('words.json');
                allWords = await res.json();

                // 2. ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏¢‡∏≤‡∏Å‡∏à‡∏≤‡∏Å LocalStorage (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)
                const savedHard = localStorage.getItem('hsk3_hard_words');
                if (savedHard) {
                    hardList = JSON.parse(savedHard);
                }

                // 3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏°‡∏î All
                setMode('all');
                updateHardCount();

            } catch (err) {
                console.error(err);
                els.hanzi.innerText = "Load Error";
                els.hanzi.style.fontSize = "30px";
            }
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏°‡∏î ---
        function setMode(mode) {
            currentMode = mode;
            currentIndex = 0;

            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active', 'shuffle-active'));

            if (mode === 'all') {
                currentDeck = [...allWords]; // ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤
                document.getElementById('btn-all').classList.add('active');
                els.modeTitle.innerText = "HSK 3 : ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö)";
            } 
            else if (mode === 'shuffle') {
                currentDeck = [...allWords];
                // Shuffle Algorithm (Fisher-Yates)
                for (let i = currentDeck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [currentDeck[i], currentDeck[j]] = [currentDeck[j], currentDeck[i]];
                }
                document.getElementById('btn-shuffle').classList.add('shuffle-active');
                els.modeTitle.innerText = "HSK 3 : ‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå";
            } 
            else if (mode === 'hard') {
                // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏°‡∏µ Hanzi ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÉ‡∏ô hardList
                currentDeck = allWords.filter(word => hardList.includes(word.hanzi));
                document.getElementById('btn-hard').classList.add('active');
                els.modeTitle.innerText = "HSK 3 : ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ";
                
                if (currentDeck.length === 0) {
                    alert("‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏ß‡πà‡∏≤ '‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ' \n‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏î‡∏≤‡∏ß ‚òÖ ‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Ñ‡∏£‡∏±‡∏ö");
                    setMode('all'); // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥
                    return;
                }
            }

            renderCard();
        }

        // --- ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î ---
        function renderCard() {
            if (!currentDeck.length) return;

            const item = currentDeck[currentIndex];

            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
            els.hanzi.innerText = item.hanzi;
            els.pinyin.innerText = item.pinyin;
            els.meaning.innerText = item.meaning;
            els.type.innerText = item.type || "";
            els.exCn.innerText = item.example_cn || "-";
            els.exTh.innerText = item.example_th || "";

            // Note section
            if (item.note) {
                els.noteSection.style.display = "block";
                els.note.innerHTML = item.note;
            } else {
                els.noteSection.style.display = "none";
            }

            // ‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤
            els.progress.innerText = `${currentIndex + 1} / ${currentDeck.length}`;

            // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏î‡∏≤‡∏ß (Hard word)
            if (hardList.includes(item.hanzi)) {
                els.starBtn.classList.add('active'); // ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á
            } else {
                els.starBtn.classList.remove('active'); // ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏ó‡∏≤
            }
        }

        // --- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏¢‡∏≤‡∏Å (Hard Words) ---
        function toggleHard(e) {
            e.stopPropagation(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏û‡∏•‡∏¥‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏î‡∏≤‡∏ß

            const currentWord = currentDeck[currentIndex];
            const wordKey = currentWord.hanzi;

            if (hardList.includes(wordKey)) {
                // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å
                hardList = hardList.filter(h => h !== wordKey);
                els.starBtn.classList.remove('active');
            } else {
                // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ
                hardList.push(wordKey);
                els.starBtn.classList.add('active');
            }

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
            localStorage.setItem('hsk3_hard_words', JSON.stringify(hardList));
            updateHardCount();
        }

        function updateHardCount() {
            els.hardCount.innerText = hardList.length;
        }

        // --- ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ---
        function flipCard() {
            els.card.classList.toggle('is-flipped');
        }

        function nextCard() {
            if (els.card.classList.contains('is-flipped')) {
                els.card.classList.remove('is-flipped');
                setTimeout(() => {
                    changeIndex(1);
                }, 300);
            } else {
                changeIndex(1);
            }
        }

        function prevCard() {
            if (els.card.classList.contains('is-flipped')) {
                els.card.classList.remove('is-flipped');
                setTimeout(() => {
                    changeIndex(-1);
                }, 300);
            } else {
                changeIndex(-1);
            }
        }

        function changeIndex(direction) {
            currentIndex += direction;
            // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ (Loop)
            if (currentIndex >= currentDeck.length) currentIndex = 0;
            if (currentIndex < 0) currentIndex = currentDeck.length - 1;
            renderCard();
        }

        // Keyboard
        document.addEventListener('keydown', (e) => {
            if (e.key === "ArrowRight") nextCard();
            if (e.key === "ArrowLeft") prevCard();
            if (e.key === " " || e.key === "Enter") flipCard();
        });

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        loadData();

    </script>
</body>
</html>