<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSK 3 Flashcard (Chinese Theme)</title>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@400;700&family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- Chinese Theme CSS --- */
        body {
            font-family: 'Sarabun', 'Noto Sans SC', sans-serif;
            /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏Ñ‡∏£‡∏µ‡∏°‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏™‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î‡∏à‡∏≤‡∏á‡πÜ */
            background-color: #f3e9d2; 
            background-image: radial-gradient(#d6c6a8 2px, transparent 2px);
            background-size: 24px 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            color: #4a4a4a;
        }

        h1 {
            color: #8b0000; /* ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏° */
            font-family: 'Noto Sans SC', sans-serif;
            font-weight: bold;
            font-size: 28px;
            margin-bottom: 15px;
            text-shadow: 1px 1px 0px rgba(255,255,255,0.5);
            letter-spacing: 2px;
        }

        /* --- Card Container (‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î) --- */
        .card-container {
            width: 420px;  /* ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô */
            height: 600px; /* ‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô */
            perspective: 1200px;
            margin-bottom: 25px;
            position: relative;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.7s cubic-bezier(0.2, 0.8, 0.2, 1);
            transform-style: preserve-3d;
            cursor: pointer;
            box-shadow: 0 15px 35px rgba(139, 0, 0, 0.2); /* ‡πÄ‡∏á‡∏≤‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏à‡∏≤‡∏á‡πÜ */
            border-radius: 20px;
        }

        .card.is-flipped { transform: rotateY(180deg); }

        /* --- ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î --- */
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            box-sizing: border-box;
            background: #fff;
            border: 8px double #8b0000; /* ‡∏Å‡∏£‡∏≠‡∏ö‡∏Ñ‡∏π‡πà‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏à‡∏µ‡∏ô */
        }

        /* --- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß (Star) --- */
        .star-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 40px;
            background: none;
            border: none;
            cursor: pointer;
            z-index: 10;
            color: #e0e0e0; 
            transition: all 0.3s;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .star-btn.active {
            color: #ffd700; /* ‡∏™‡∏µ‡∏ó‡∏≠‡∏á */
            transform: scale(1.2);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
        }
        .star-btn:hover { transform: scale(1.1); }

        /* --- ‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡∏ï‡∏±‡∏ß‡∏à‡∏µ‡∏ô) --- */
        .card-front {
            background-color: #fffbf0; /* ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏ô‡∏ß‡∏• */
            /* ‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏à‡∏≤‡∏á‡πÜ ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d00000' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .hanzi-lg {
            font-family: 'Ma Shan Zheng', cursive, 'Noto Sans SC', serif; /* ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏û‡∏π‡πà‡∏Å‡∏±‡∏ô */
            font-size: 110px; /* ‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏∞‡πÉ‡∏à */
            color: #8b0000;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }
        .tap-hint {
            font-size: 16px;
            color: #a67c52;
            margin-top: 50px;
            border-top: 1px solid #d6c6a8;
            padding-top: 10px;
            width: 60%;
            text-align: center;
        }

        /* --- ‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á (‡πÄ‡∏â‡∏•‡∏¢) --- */
        .card-back {
            background: linear-gradient(145deg, #8b0000 0%, #600000 100%); /* ‡πÅ‡∏î‡∏á‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î */
            color: #fff;
            transform: rotateY(180deg);
            align-items: flex-start;
            text-align: left;
            overflow-y: auto;
            border-color: #d4af37; /* ‡∏Ç‡∏≠‡∏ö‡∏™‡∏µ‡∏ó‡∏≠‡∏á */
        }
        
        /* Scrollbar ‡∏™‡∏ß‡∏¢‡πÜ */
        .card-back::-webkit-scrollbar { width: 6px; }
        .card-back::-webkit-scrollbar-thumb { background: rgba(255,215,0,0.3); border-radius: 3px; }

        .header-group {
            width: 100%;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3); /* ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏µ‡∏î‡∏ó‡∏≠‡∏á */
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .pinyin {
            font-size: 32px;
            color: #ffd700; /* ‡∏™‡∏µ‡∏ó‡∏≠‡∏á */
            font-weight: 500;
            letter-spacing: 1px;
        }
        .meaning {
            font-size: 26px;
            font-weight: bold;
            margin-top: 8px;
            color: #fff;
        }
        .type-tag {
            display: inline-block;
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.5);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 14px;
            margin-top: 8px;
            color: #ffd700;
        }

        .section-title {
            font-size: 14px;
            color: #cca4a4;
            margin-bottom: 8px;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
        }
        .section-title::before {
            content: '‚ú¶';
            margin-right: 5px;
            color: #ffd700;
        }

        .example-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 12px;
            width: 100%;
            margin-bottom: 10px;
            border-left: 4px solid #ffd700; /* ‡πÅ‡∏ñ‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡∏™‡∏µ‡∏ó‡∏≠‡∏á */
        }
        .ex-cn { font-size: 20px; color: #fff; margin-bottom: 6px; font-weight: 400; line-height: 1.5; }
        .ex-th { font-size: 16px; color: #ddd; font-style: italic; }

        .note-box {
            font-size: 15px;
            color: #fff;
            line-height: 1.6;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px 15px;
            border-radius: 10px;
            width: 100%;
        }

        /* --- Controls & Menu --- */
        .controls { display: flex; align-items: center; gap: 20px; margin-top: 10px; }
        
        .nav-btn {
            background: #8b0000;
            color: #ffd700;
            border: 2px solid #8b0000;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .nav-btn:hover {
            background: #a50000;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }
        .nav-btn:active { transform: translateY(0); }

        .progress {
            font-weight: 600;
            color: #8b0000;
            font-size: 18px;
            min-width: 90px;
            text-align: center;
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid #d6c6a8;
        }

        .menu-bar { margin-top: 25px; display: flex; gap: 12px; }
        
        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #a67c52;
            background: white;
            color: #5d4037;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Sarabun', sans-serif;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.2s;
        }
        .mode-btn:hover { background: #fdf5e6; }
        
        .mode-btn.active {
            background: #8b0000;
            color: #ffd700;
            border-color: #8b0000;
            box-shadow: 0 4px 10px rgba(139, 0, 0, 0.3);
        }
        .mode-btn.shuffle-active {
            background: #1e3a8a; /* ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏°‡πÅ‡∏ö‡∏ö‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏≤‡∏° */
            color: white;
            border-color: #1e3a8a;
        }

    </style>
</head>
<body>

    <h1 id="mode-title">HSK 3 : ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô</h1>

    <div class="card-container">
        <button class="star-btn" id="star-btn" onclick="toggleHard(event)">‚òÖ</button>

        <div class="card" id="flashcard" onclick="flipCard()">
            <div class="card-face card-front">
                <div class="hanzi-lg" id="front-hanzi">Âä†ËΩΩ‰∏≠...</div>
                <div class="tap-hint">(‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢)</div>
            </div>

            <div class="card-face card-back">
                <div class="header-group">
                    <div class="pinyin" id="back-pinyin">...</div>
                    <div class="meaning" id="back-meaning">...</div>
                    <span class="type-tag" id="back-type">...</span>
                </div>

                <div class="section-title">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ</div>
                <div class="example-box">
                    <div class="ex-cn" id="back-ex-cn">...</div>
                    <div class="ex-th" id="back-ex-th">...</div>
                </div>

                <div id="note-section" style="display:none; width: 100%;">
                    <div class="section-title">‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï / ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</div>
                    <div class="note-box" id="back-note">...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="nav-btn" onclick="prevCard()">&#10094;</button>
        <span class="progress" id="progress-text">0 / 0</span>
        <button class="nav-btn" onclick="nextCard()">&#10095;</button>
    </div>

    <div class="menu-bar">
        <button class="mode-btn active" id="btn-all" onclick="setMode('all')">üìú ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        <button class="mode-btn" id="btn-shuffle" onclick="setMode('shuffle')">üîÄ ‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥</button>
        <button class="mode-btn" id="btn-hard" onclick="setMode('hard')">‚≠ê ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (<span id="hard-count">0</span>)</button>
    </div>

    <script>
        // --- JavaScript Logic (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) ---
        let allWords = [];
        let currentDeck = [];
        let currentIndex = 0;
        let hardList = [];
        let currentMode = 'all';

        const els = {
            card: document.getElementById('flashcard'),
            hanzi: document.getElementById('front-hanzi'),
            pinyin: document.getElementById('back-pinyin'),
            meaning: document.getElementById('back-meaning'),
            type: document.getElementById('back-type'),
            exCn: document.getElementById('back-ex-cn'),
            exTh: document.getElementById('back-ex-th'),
            note: document.getElementById('back-note'),
            noteSection: document.getElementById('note-section'),
            progress: document.getElementById('progress-text'),
            starBtn: document.getElementById('star-btn'),
            hardCount: document.getElementById('hard-count'),
            modeTitle: document.getElementById('mode-title')
        };

        async function loadData() {
            try {
                const res = await fetch('words.json');
                allWords = await res.json();
                const savedHard = localStorage.getItem('hsk3_hard_words');
                if (savedHard) hardList = JSON.parse(savedHard);
                setMode('all');
                updateHardCount();
            } catch (err) {
                console.error(err);
                els.hanzi.innerText = "Error";
            }
        }

        function setMode(mode) {
            currentMode = mode;
            currentIndex = 0;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active', 'shuffle-active'));

            if (mode === 'all') {
                currentDeck = [...allWords];
                document.getElementById('btn-all').classList.add('active');
                els.modeTitle.innerText = "HSK 3 : ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö)";
            } 
            else if (mode === 'shuffle') {
                currentDeck = [...allWords];
                for (let i = currentDeck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [currentDeck[i], currentDeck[j]] = [currentDeck[j], currentDeck[i]];
                }
                document.getElementById('btn-shuffle').classList.add('shuffle-active');
                els.modeTitle.innerText = "HSK 3 : ‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå";
            } 
            else if (mode === 'hard') {
                currentDeck = allWords.filter(word => hardList.includes(word.hanzi));
                document.getElementById('btn-hard').classList.add('active');
                els.modeTitle.innerText = "HSK 3 : ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ";
                if (currentDeck.length === 0) {
                    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ");
                    setMode('all');
                    return;
                }
            }
            renderCard();
        }

        function renderCard() {
            if (!currentDeck.length) return;
            const item = currentDeck[currentIndex];
            els.hanzi.innerText = item.hanzi;
            els.pinyin.innerText = item.pinyin;
            els.meaning.innerText = item.meaning;
            els.type.innerText = item.type || "";
            els.exCn.innerText = item.example_cn || "-";
            els.exTh.innerText = item.example_th || "";

            if (item.note) {
                els.noteSection.style.display = "block";
                els.note.innerHTML = item.note;
            } else {
                els.noteSection.style.display = "none";
            }

            els.progress.innerText = `${currentIndex + 1} / ${currentDeck.length}`;

            if (hardList.includes(item.hanzi)) {
                els.starBtn.classList.add('active');
            } else {
                els.starBtn.classList.remove('active');
            }
        }

        function toggleHard(e) {
            e.stopPropagation();
            const currentWord = currentDeck[currentIndex];
            const wordKey = currentWord.hanzi;

            if (hardList.includes(wordKey)) {
                hardList = hardList.filter(h => h !== wordKey);
                els.starBtn.classList.remove('active');
            } else {
                hardList.push(wordKey);
                els.starBtn.classList.add('active');
            }
            localStorage.setItem('hsk3_hard_words', JSON.stringify(hardList));
            updateHardCount();
        }

        function updateHardCount() {
            els.hardCount.innerText = hardList.length;
        }

        function flipCard() { els.card.classList.toggle('is-flipped'); }

        function nextCard() {
            if (els.card.classList.contains('is-flipped')) {
                els.card.classList.remove('is-flipped');
                setTimeout(() => changeIndex(1), 300);
            } else { changeIndex(1); }
        }

        function prevCard() {
            if (els.card.classList.contains('is-flipped')) {
                els.card.classList.remove('is-flipped');
                setTimeout(() => changeIndex(-1), 300);
            } else { changeIndex(-1); }
        }

        function changeIndex(dir) {
            currentIndex += dir;
            if (currentIndex >= currentDeck.length) currentIndex = 0;
            if (currentIndex < 0) currentIndex = currentDeck.length - 1;
            renderCard();
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === "ArrowRight") nextCard();
            if (e.key === "ArrowLeft") prevCard();
            if (e.key === " " || e.key === "Enter") flipCard();
        });

        loadData();
    </script>
</body>
</html>